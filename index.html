<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PJ Official – Under Maintenance</title>
</head>

<body
  style="
    margin:0;
    min-height:100vh;
    background:#000;
    color:#fff;
    font-family:Arial, Helvetica, sans-serif;
    display:flex;
    align-items:center;
    justify-content:center;
    text-align:center;
  "
>

<div style="width:360px;padding:24px;">

  <!-- GEARS -->
  <div style="position:relative;height:120px;margin-bottom:30px;">
    <div class="gear big">⚙️</div>
    <div class="gear small">⚙️</div>
  </div>

  <h2>PJ official website is under update</h2>

  <p style="color:#ccc;font-size:14px;">
    Enter your email to get notified once the website is live.
  </p>

  <!-- SINGLE INPUT -->
  <input
    id="inputValue"
    type="text"
    placeholder="Enter your email"
    style="
      width:100%;
      padding:12px;
      margin-top:20px;
      border:none;
      border-radius:6px;
      outline:none;
      font-size:14px;
    "
  />

  <button
    id="continueBtn"
    style="
      margin-top:20px;
      width:100%;
      padding:12px;
      border:none;
      border-radius:30px;
      background:#ff7a00;
      color:#000;
      font-weight:bold;
      cursor:pointer;
    "
  >
    Continue
  </button>

  <p id="msg" style="font-size:12px;margin-top:12px;"></p>

  <!-- ADMIN PANEL (HIDDEN) -->
  <div id="adminPanel" style="display:none;margin-top:30px;">
    <p style="color:#ccc;font-size:14px;">
      Admin panel unlocked
    </p>

    <button
      id="doneBtn"
      style="
        margin-top:10px;
        width:100%;
        padding:12px;
        border:none;
        border-radius:30px;
        background:#ff7a00;
        color:#000;
        font-weight:bold;
        cursor:pointer;
      "
    >
      DONE – Send Update Email
    </button>

    <p id="adminStatus" style="font-size:12px;margin-top:12px;"></p>
  </div>

</div>

<script type="module">
import { db } from "./firebase.js";
import {
  collection,
  addDoc,
  getDocs,
  query,
  where,
  updateDoc,
  doc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

import emailjs from "https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js";
emailjs.init("EevqJ2-cX2wrZXXJO");

const ADMIN_PASSWORD = "sonu@jeet";

const input = document.getElementById("inputValue");
const msg = document.getElementById("msg");
const adminPanel = document.getElementById("adminPanel");
const adminStatus = document.getElementById("adminStatus");

document.getElementById("continueBtn").addEventListener("click", async () => {
  const value = input.value.trim();

  if (!value) {
    msg.innerText = "Please enter email";
    msg.style.color = "red";
    return;
  }

  /* ---------- ADMIN DETECT ---------- */
  if (value === ADMIN_PASSWORD) {
    adminPanel.style.display = "block";
    msg.innerText = "Admin access granted";
    msg.style.color = "#00ff99";
    input.value = "";
    return;
  }

  /* ---------- NORMAL USER ---------- */
  const q = query(
    collection(db, "notifyEmails"),
    where("email", "==", value)
  );
  const snap = await getDocs(q);

  if (!snap.empty) {
    msg.innerText = "Email already registered";
    msg.style.color = "orange";
    return;
  }

  await addDoc(collection(db, "notifyEmails"), {
    email: value,
    notified: false,
    createdAt: Date.now()
  });

  await emailjs.send(
    "service_4mpzhc6",
    "template_b2flto4",
    { to_email: value }
  );

  msg.innerText = "Email saved successfully";
  msg.style.color = "#00ff99";
  input.value = "";
});

/* ---------- ADMIN DONE BUTTON ---------- */
document.getElementById("doneBtn").addEventListener("click", async () => {
  adminStatus.innerText = "Sending emails...";
  adminStatus.style.color = "#ccc";

  const snap = await getDocs(collection(db, "notifyEmails"));
  let count = 0;

  for (const d of snap.docs) {
    const data = d.data();
    if (data.notified) continue;

    await emailjs.send(
      "service_4mpzhc6",
      "template_b2flto4",
      { to_email: data.email }
    );

    await updateDoc(doc(db, "notifyEmails", d.id), {
      notified: true
    });

    count++;
  }

  adminStatus.innerText = `Completed. ${count} emails sent.`;
  adminStatus.style.color = "#00ff99";
});
</script>

<style>
.gear {
  position:absolute;
  color:#ff7a00;
}

.big {
  font-size:90px;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
  animation:spin 4s linear infinite;
}

.small {
  font-size:40px;
  left:65%;
  top:35%;
  animation:spinReverse 2s linear infinite;
}

@keyframes spin {
  from { transform:translate(-50%,-50%) rotate(0); }
  to { transform:translate(-50%,-50%) rotate(360deg); }
}

@keyframes spinReverse {
  from { transform:rotate(360deg); }
  to { transform:rotate(0); }
}
</style>

</body>
</html>
